#!/bin/bash

foldername=$(date +%Y-%m-%d_%H-%M-%S)

##SOURCE_SITE
#tar -cpz /usr/share/nginx/unique-romania.studio/ | split -d -b 240m - /usr/share/nginx/unique-romania.studio/site_$(date +%Y-%m-%d_%H-%M-%S).tar.gz

CONFIG_FILE=/home/mikes/Desktop/Riba/backup.conf

if [[ -f $CONFIG_FILE ]]; then
        . $CONFIG_FILE
fi

tar -cpz $SOURCE_SITE | split -d -b 230m - $SOURCE_SITE/site_$(date +%Y-%m-%d_%H-%M-%S).tar.gz

mkdir -p $DESTINATION_SITE

#SOURCE_SITE DESTINATION_SITE
rsync -azvv $SOURCE_SITE/site_* $DESTINATION_SITE

rm -rf $SOURCE_SITE/site_* 

#DB_NAME SOURCE_DB
mongodump -d $DB_NAME -o $SOURCE_DB/$(date +%Y-%m-%d_%H-%M-%S).csv

#SOURCE_DB
tar -cpz $SOURCE_DB | split -d -b 240m - $SOURCE_DB/db_mongo_$(date +%Y-%m-%d_%H-%M-%S).tar.gz

#DESTINATION_DB
mkdir -p  $DESTINATION_DB

#SOURCE_DB DESTINATION_DB
rsync -azvv $SOURCE_DB/db_mongo_* $DESTINATION_DB

rm -rf $SOURCE_DB/db_mongo_* 

